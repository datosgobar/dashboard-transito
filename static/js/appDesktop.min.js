function armoSelectAnomalias(a){for(var b=0;b<a.causas.length;b++)$("#causa_frm").append('<option value="'+a.causas[b].id+'">'+a.causas[b].descripcion+"</option>")}function actualizoRegistro(){var a=$("#descripcion_frm").val();(void 0===a||"undefined"===a)&&(a="");var b="anomaly_id="+$("#anomaly_frm").val()+"&comentario="+a+"&causa_id="+$("#causa_frm").val()+"&tipo_corte="+$("#corte_frm").val();$.ajax({type:"POST",url:"/",data:b,success:function(a){$("#mensajeStatus_frm").show(),"guardado"===a?($("#mensajeStatus_frm").html("Guardado"),$("#reportar_frm").hide(),$("#modificar_frm").show(),$("#mensajeStatus_frm").delay(1e3).hide("slow")):($("#mensajeStatus_frm").html(a),$("#mensajeStatus_frm").delay(3e3).hide("slow"))},contentType:"application/x-www-form-urlencoded"})}function cierroEdicion(){$("#cuadroOperador").animate({top:"100%"},200),$(".corredor").removeClass("corredorActivo")}function abreDetalleCorredor(a){$(".corredorActivo").removeClass("corredorActivo"),$("#"+a[0].id).addClass("corredorActivo"),$("#cuadroOperador").fadeOut(0);var b=a.find(".titulo");$("#corredores .titulo")[0].innerHTML=b[0].innerHTML,llenaPantallaActualizacion(b.parent()[0].id),$("#cuadroOperador").fadeIn("fast"),panTo(geolocalizacion[a[0].id].latlng)}function llenaPantallaActualizacion(a){var b=0,c="",d=[0,0],e="",f="",g=0,h=0,i=0,j="";$("#corredores .etiquetasCapital").html(""),$("#corredores .etiquetasProvincia").html(""),$("#corredores #corredorCapital").html(""),$("#corredores #corredorProvincia").html(""),$("#avisoProvincia").html(""),$("#avisoCapital").html(""),$("#corredores .corredoresCapital").html(""),$("#corredores .corredoresProvincia").html(""),$("#panelesProvincia").html(""),$("#panelesCapital").html(""),"undefined"!=typeof corredores[a].provincia&&(b=corredores[a].provincia.length,c=corredores[a].provincia,e=corredores[a].provincia,d[1]=1),"undefined"!=typeof corredores[a].capital&&(b=corredores[a].capital.length,c=corredores[a].capital,f=corredores[a].capital,d[0]=1);for(var k=0;k<c.length;k++){var l="cen";0===k&&(l="izq"),$("#corredores .etiquetasCapital").append('<div class="nombreCorredor '+l+'">'+nombresDeCorredores[c[k]].nombreSegmento.split(" - ")[0]+"</div>"),$("#corredores .etiquetasProvincia").append('<div class="nombreCorredor '+l+'">'+nombresDeCorredores[c[k]].nombreSegmento.split(" - ")[0]+"</div>")}$("#corredores .etiquetasCapital").append('<div class="nombreCorredor der">'+nombresDeCorredores[c[c.length-1]].nombreSegmento.split(" - ")[1]+"</div>"),$("#corredores .etiquetasProvincia").append('<div class="nombreCorredor der">'+nombresDeCorredores[c[c.length-1]].nombreSegmento.split(" - ")[1]+"</div>"),0===d[1]&&$("#avisoProvincia").append('<div id="aviso">El trayecto no tiene dirección hacia Provincia</div>'),0===d[0]&&$("#avisoCapital").append('<div id="aviso">El trayecto no tiene dirección hacia Capital</div>');for(var k=0;k<c.length;k++){if(0===d[0])$("#corredores .corredoresCapital").append('<div class="corredor segmento estado0"></div>');else{if($("#corredores .corredoresCapital").append('<div class="corredor segmento estado'+nombresDeCorredores[f[k]].anomalia+'"></div>'),g=0!=nombresDeCorredores[f[k]].duracion_anomalia?nombresDeCorredores[f[k]].duracion_anomalia+"'":"--",h=nombresDeCorredores[f[k]].tiempo,0!=nombresDeCorredores[f[k]].indicador_anomalia){var m=h*(100*nombresDeCorredores[f[k]].indicador_anomalia).toFixed()/100;i=(100*nombresDeCorredores[f[k]].indicador_anomalia).toFixed()+"% (+ "+m.toFixed()+"')"}else i="--";0==nombresDeCorredores[f[k]].causa_id?j="--":jQuery.map(causasAnomalias.causas,function(a){a.id==nombresDeCorredores[f[k]].causa_id&&(j=a.descripcion)}),$("#panelesCapital").append('<div class="panel" id="c'+f[k]+'"><div class="filaPanel">Duración anomalía<div class="datoPanel">'+g+'</div></div><div class="filaPanel">Tiempo del trayecto<div class="datoPanel">'+h+'\'</div></div><div class="filaPanel">Demora<div class="datoPanel">'+i+'</div></div><div class="filaPanel">Causa<div class="datoPanel">'+j+"</div></div></div>")}if(0===d[1])$("#corredores .corredoresProvincia").append('<div class="corredor segmento estado0"> </div>');else{if($("#corredores .corredoresProvincia").append('<div class="corredor segmento estado'+nombresDeCorredores[e[k]].anomalia+' "></div>'),g=0!=nombresDeCorredores[e[k]].duracion_anomalia?nombresDeCorredores[e[k]].duracion_anomalia+"'":"--",h=nombresDeCorredores[e[k]].tiempo,0!=nombresDeCorredores[e[k]].indicador_anomalia){var m=h*(100*nombresDeCorredores[e[k]].indicador_anomalia).toFixed()/100;i=(100*nombresDeCorredores[e[k]].indicador_anomalia).toFixed()+"% (+ "+m.toFixed()+"')"}else i="--";0==nombresDeCorredores[e[k]].causa_id?j="--":jQuery.map(causasAnomalias.causas,function(a){a.id==nombresDeCorredores[e[k]].causa_id&&(j=a.descripcion)}),$("#panelesProvincia").append('<div class="panel" id="c'+e[k]+'"><div class="filaPanel">Duración anomalía<div class="datoPanel">'+g+'</div></div><div class="filaPanel">Tiempo del trayecto<div class="datoPanel">'+h+'\'</div></div><div class="filaPanel">Demora<div class="datoPanel">'+i+'</div></div><div class="filaPanel">Causa<div class="datoPanel">'+j+"</div></div></div>")}}$(".panel").click(function(){var a=this.id.replace("c","");llenoPantallaEdicion(a),$("#seleccioneTrayecto").css("display","none")})}function llenoPantallaEdicion(a){var b=nombresDeCorredores[a].tiempo*(100*nombresDeCorredores[a].indicador_anomalia).toFixed()/100,c=(100*nombresDeCorredores[a].indicador_anomalia).toFixed()+"% (+ "+b.toFixed()+"')";0==nombresDeCorredores[a].indicador_anomalia&&(c="--"),$("#trayecto_frm").html(nombresDeCorredores[a].nombreSegmento),$("#sentido_frm").html(nombresDeCorredores[a].sentido),$("#anomalia_frm").html(anomaliasDescripcion[nombresDeCorredores[a].causa_id]),$("#tiempo_frm").html(nombresDeCorredores[a].tiempo+"'"),$("#demora_frm").html(c),$("#mensajeStatus_frm").html(""),$("#reportar_frm").show(),$("#modificar_frm").hide(),0!=nombresDeCorredores[a].anomalia_id?($("#oculta").css("display","none"),$("#anomaly_frm").attr("value",nombresDeCorredores[a].anomalia_id),$("#corte_frm").val(nombresDeCorredores[a].tipo_corte),$("#causa_frm").val(nombresDeCorredores[a].causa_id),$("#descripcion_frm").val(nombresDeCorredores[a].comentario_causa)):$("#oculta").css("display","inline")}function actualizacionDesktop(a){var b=[],c=[],d="",e=0,f=!1,g=!1;if($("#"+a.id+" .titulo").html(a.nombre),$("#"+a.id).removeClass("cargando"),0!=a.segmentos_capital.length){for(var h=0;h<a.segmentos_capital.length;h++)0!=a.segmentos_capital[h].anomalia_id&&(f=!0,0==a.segmentos_capital[h].causa_id&&(g=!0)),e<a.segmentos_capital[h].anomalia&&(e=a.segmentos_capital[h].anomalia),nombresDeCorredores[a.segmentos_capital[h].id].sentido="capital",nombresDeCorredores[a.segmentos_capital[h].id].anomalia=a.segmentos_capital[h].anomalia,nombresDeCorredores[a.segmentos_capital[h].id].anomalia_id=a.segmentos_capital[h].anomalia_id,nombresDeCorredores[a.segmentos_capital[h].id].tipo_corte=a.segmentos_capital[h].tipo_corte,nombresDeCorredores[a.segmentos_capital[h].id].comentario_causa=a.segmentos_capital[h].causa,nombresDeCorredores[a.segmentos_capital[h].id].causa_id=a.segmentos_capital[h].causa_id,nombresDeCorredores[a.segmentos_capital[h].id].duracion_anomalia=a.segmentos_capital[h].duracion_anomalia,nombresDeCorredores[a.segmentos_capital[h].id].id=a.segmentos_capital[h].id,nombresDeCorredores[a.segmentos_capital[h].id].indicador_anomalia=a.segmentos_capital[h].indicador_anomalia,nombresDeCorredores[a.segmentos_capital[h].id].tiempo=a.segmentos_capital[h].tiempo,nombresDeCorredores[a.segmentos_capital[h].id].velocidad=a.segmentos_capital[h].velocidad,b.push(a.segmentos_capital[h].id);d='"capital":['+b.toString()+"]"}if(0!=a.segmentos_provincia.length){for(var i=0;i<a.segmentos_provincia.length;i++)0!=a.segmentos_provincia[i].anomalia_id&&(f=!0,0==a.segmentos_provincia[i].causa_id&&(g=!0)),e<a.segmentos_provincia[i].anomalia&&(e=a.segmentos_provincia[i].anomalia),nombresDeCorredores[a.segmentos_provincia[i].id].sentido="provincia",nombresDeCorredores[a.segmentos_provincia[i].id].anomalia=a.segmentos_provincia[i].anomalia,nombresDeCorredores[a.segmentos_provincia[i].id].anomalia_id=a.segmentos_provincia[i].anomalia_id,nombresDeCorredores[a.segmentos_provincia[i].id].tipo_corte=a.segmentos_provincia[i].tipo_corte,nombresDeCorredores[a.segmentos_provincia[i].id].comentario_causa=a.segmentos_provincia[i].causa,nombresDeCorredores[a.segmentos_provincia[i].id].causa_id=a.segmentos_provincia[i].causa_id,nombresDeCorredores[a.segmentos_provincia[i].id].duracion_anomalia=a.segmentos_provincia[i].duracion_anomalia,nombresDeCorredores[a.segmentos_provincia[i].id].id=a.segmentos_provincia[i].id,nombresDeCorredores[a.segmentos_provincia[i].id].indicador_anomalia=a.segmentos_provincia[i].indicador_anomalia,nombresDeCorredores[a.segmentos_provincia[i].id].tiempo=a.segmentos_provincia[i].tiempo,nombresDeCorredores[a.segmentos_provincia[i].id].velocidad=a.segmentos_provincia[i].velocidad,c.push(a.segmentos_provincia[i].id);d=""!=d?d+',"provincia":['+c.toString()+"]":'"provincia":['+c.toString()+"]"}$("#"+a.id).removeClass(),$("#"+a.id).addClass("corredor shadow listado borde"+e);var j=$("#"+a.id+" .icono");j.removeClass(),j.addClass("icono"),f?g?j.addClass("iconoRojo"):j.addClass("iconoAzul"):j.addClass("iconoGris");var k=JSON.parse("{"+d+"}");corredores[a.id]=k}function updateUltimaActualizacion(a){$("#ultimaActualizacion").html(a)}function panTo(a){var b=new google.maps.LatLng(a.split(",")[0],a.split(",")[1]);map.panTo(b)}var corredores=JSON.parse("{}"),anomaliasDescripcion=["--","Intermedia","Grave"],nombresDeCorredores=function(){var a=null;return $.ajax({async:!1,global:!1,url:"_static/data/segmentos.json",dataType:"json",success:function(b){a=b}}),a}(),geolocalizacion=function(){var a=null;return $.ajax({async:!1,global:!1,url:"_static/data/geolocalizacion.json",dataType:"json",success:function(b){a=b}}),a}(),causasAnomalias=function(){var a=null;return $.ajax({async:!1,global:!1,url:"_static/data/causas.json",dataType:"json",success:function(b){a=b,armoSelectAnomalias(b)}}),a}();$("#logo").click(function(){cierroEdicion()}),$(".corredor").click(function(){$("#seleccioneTrayecto").css("display","inline"),$("#oculta").css("display","none");var a=$(this);$(this).hasClass("cargando")===!1&&$(this).hasClass("corredorActivo")===!1?(abreDetalleCorredor(a),$("#cuadroOperador").animate({top:"300px"},200)):($(this).removeClass("corredorActivo"),cierroEdicion())}),$("#salir").click(function(){window.location="/logout"}),$("#verAnomalias").click(function(){window.location="/anomalies"});